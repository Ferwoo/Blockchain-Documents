## 背景

为对链上数据进行加密，控制密钥的分发，达到控制数据访问权限的管理目的，其**本质是数据的隐私保护**。

## Fabric隐私保护

Fabric目前有2种隐私保护方法：

1. 多通道提供的数据隔离特性：只有在当前通道中的组织才能读写该账本的数据，不在该通道中的组织无法访问本通道数据。比如，企业A、B之间的某种数据不能被其他企业访问，A和B可以建立新的通道，保存私有数据。
2. 私有数据特性提供的隐私保护：私有数据即[Private Data](https://hyperledger-fabric.readthedocs.io/en/release-1.4/private-data/private-data.html)，也被称为Side DB，可以提供比多通道更细粒度的隐私保护。可以在通道内，限定某块数据集合被哪些组织访问的权限。比如，通道中存在企业A、B、C，A和B的交易隐私，设置为只有A和B有权限读写，则C不能读写这部分私有数据。

多通道适合较大粒度的数据隐私保护，私有数据适合较小粒度的数据隐私保护。

Fabric在增强隐私保护特性时，曾考虑加入链上数据加密的方式，但这种方式没有被采纳，而是采纳了私有数据，原因如下：

1. 加密需要使用密钥，如何实现密钥的创建和分发，由谁来管理？
2. 不同交易采用不同的密钥，会给网络增加多少加解密的计算量？
3. 密钥该保存在何处，如何确保密钥不被泄露？如果使用后销毁密钥，以防泄露，那新加入的节点如何在没有密钥的情况下，同步加密的数据？

### 多通道

原理：每个通道都维护一份单独的账本，从文件上就实现了数据的隔离和保护，实现了通道（账本）级的隐私保护。

缺点：为了隐私保护，通道中只有2个企业，如果某个企业修改了数据，如何分辨2份数据，那份才是真实的数据？

### 私有数据

Fabric提供了一种把私有数据从交易中剥离的办法，确保私有数据只被限定的Peer访问。

私有数据发送给符合私有数据指定策略的背书节点，使用Gossip在有权限的节点之间传送私有数据，私有数据会被**暂存**在单独的**private transient db**中，这样不具有私有数据权限的Peer，无法获取、访问私有数据。

背书节点将私有数据的背书结果的Hash返回给客户端，客户端创建的交易只包含Hash，并将交易发送给Orderer进行排序，Orderer也无法访问私有数据。

交易被拥有私有数据的权限的Peer验证，模拟执行交易，并计算**private transient db**中暂存的私有数据的Hash，是否与交易中的Hash匹配，交易验证通过，私有数据会被保存到**private state db**中。

另外，私有数据还支持冗余备份，数据自动删除等特性，可在私有数据。

## 推荐隐私保护策略

1. 为某一项业务，建立单独的通道，需要访问该业务数据的企业，都可以加入到该通道。
2. 在开发业务链码时，分析好哪些数据是私有的，即只有允许的组织可以读写私有数据，为这些数据创建私有数据配置（被称为collection），设置好可访问该数据的组织，以及数据可存活的区块高度数。在部署链码时，指定私有数据配置文件。如果私有数据添加或删除组织，可以升级链码指定新的私有数据配置文件。

Fabric 1.0开始支持多通道，Fabric 1.1开始支持Private data，Fabric 1.0.3，需要在业务（链码）层面通过权限控制实现隐私保护**。如果升级到当前稳定支持的Fabric 1.4版本，建议使用Private data实现更细粒度的隐私保护。









